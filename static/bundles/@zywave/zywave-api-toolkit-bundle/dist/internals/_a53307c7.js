import{i as t,a as i,n as e,Z as n,c as s,k as o}from"./_39a3718f.js";const a=t`:host{position:absolute;display:none;width:0;height:0;border:0}`;function c(t,i){return new Promise(((e,n)=>{let s;if(s="string"==typeof t?new URL(t):t,i?.preconfigureUrl&&(s=i.preconfigureUrl(s)),document.querySelector(`script[src="${s}"]`))e();else{const t=document.createElement("script");t.type="text/javascript",t.async=!0,t.defer=!0,t.src=s.toString(),i?.preconfigureScriptElement&&i.preconfigureScriptElement(t),document.head.appendChild(t),t.addEventListener("load",(()=>e())),t.addEventListener("error",(()=>n()))}}))}function r(t,i,e){Event.prototype.composedPath&&t.addEventListener(i,(t=>{const i=t.composedPath();i&&i.length&&i[0]!==t.target&&i[0]instanceof Element&&e(t,i[0])}))}async function d(t,i,e,n,s){n??={};const o=new URL("cdn.heapanalytics.com/js/",s);function a(t,i){return{"Target ID":i.id,"Target Class":i.className,"Target Tag":i.tagName,"Target Text":i.textContent,"Target Name":i.getAttribute("name"),"Target Type":i.getAttribute("type"),"Target Href":i.getAttribute("href"),"Target Action":i.getAttribute("action")}}function d(){window.heap.track("View")}try{return await c(o,{preconfigureUrl:s=>{const o=window.heap||[];window.heap=o,o.appid=t,o.config={},i&&o.push(["identify",i]);const a=n?.isImpersonating??!1;if(e){if("userPrincipalId"in e&&(e["User Principal ID"]=e.userPrincipalId,delete e.userPrincipalId),!a){const t={prefersDarkMode:window.matchMedia?.("(prefers-color-scheme: dark)").matches??!1};e={...t,...e}}o.push(["addUserProperties",e])}const c=function(){if(!window.navigator.connection)return;const t="unknown"===window.navigator.connection.type?void 0:window.navigator.connection.type;return{networkReducedData:window.navigator.connection.saveData??!1,networkConnectionType:t,networkRtt:window.navigator.connection.rtt,networkDownlink:window.navigator.connection.downlink,networkDownlinkMax:window.navigator.connection.downlinkMax}}(),r={screenWidth:window.screen.width,screenHeight:window.screen.height,screenResolution:`${window.screen.width}x${window.screen.height}`,...c,...n};return"userPrincipalId"in r&&(r["User Principal ID"]=r.userPrincipalId,delete r.userPrincipalId),"isImpersonating"in r&&(r["User Profile Impersonated"]=(r.isImpersonating??!1).toString(),delete r.isImpersonating),o.clearEventProperties?.(),o.push(["addEventProperties",r]),o.track=(t,...i)=>{i.unshift(t,"track"),o.push(i)},s=new URL(`heap-${t}.js`,s)}}),window.heap&&(r(window.document,"click",((t,i)=>{window.heap.track("Composed click",a(0,i))})),r(window.document,"submit",((t,i)=>{window.heap.track("Composed submit",a(0,i))})),r(window.document,"change",((t,i)=>{window.heap.track("Composed change",a(0,i))})),window.addEventListener("zapiReplaceState",d),window.addEventListener("zapiPushState",d)),{track(t,i){window.heap?.track?.(t,i)},trackerId:"Heap"}}catch{return}}const h="ZUI-Utilization",w="ZAPI-Utilization";class p{#t;#i;#e;constructor(t,i){this.#t=t,this.#i=i,this.#n()}#n(){window.navigator.connection?.saveData&&"4g"!==window.navigator.connection?.effectiveType||("complete"===document.readyState?this.#s():document.addEventListener("readystatechange",(()=>{"complete"===document.readyState&&this.#s()})),window.addEventListener("zapiPushState",(()=>this.#s())),window.addEventListener("zapiReplaceState",(()=>this.#s())))}#s(){window.clearTimeout(this.#e),this.#e=window.setTimeout((()=>{const t=window?.zywave?.zui?.analytics?.getReport("instance")??null,e=i?.getReport("instance")??null;return Promise.allSettled([this.#o(w,e),this.#o(h,t)])}),300)}async#o(t,i){if(!i)return;const e=new URL("shell/v2.0/analyticsinfo/track",this.#t),n={eventName:t,payload:{},origin:window.location.origin,path:window.location.pathname,hash:window.location.hash};for(const t of i.keys())n.payload[t]=i.get(t);await this.#i.fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}}const l=class{static get instance(){return this.#a??=new this}static#a;#c=[];constructor(){}track(t,i){for(const e of this.#c)e.then((e=>e?.track(t,i)))}registerTracker(t){t&&this.#c.push(Promise.resolve(t))}}.instance;var u=function(t,i,e,n){var s,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,e,n);else for(var c=t.length-1;c>=0;c--)(s=t[c])&&(a=(o<3?s(a):o>3?s(i,e,a):s(i,e))||a);return o>3&&a&&Object.defineProperty(i,e,a),a};let f=new URL(import.meta.url).origin;f.includes("unpkg.com")&&(f="https://cdn.zywave.com",console.warn("Loading the Zywave API Toolkit from unpkg.com is deprecated. Please use cdn.zywave.com instead. Your application is likely to break."));class y extends n{constructor(){super(...arguments),this.heapAppId=null,this.appcuesAccountId=null,this.identity=null,this.userProperties=null,this.defer=!1,this.cdnHost=f,this.contextPath=null,this.#r=!1}static get styles(){return[a]}#d;#h;get#w(){return this.#d?.["track-web-sdk-utilization"]??!1}get#p(){return!!(this.heapAppId||this.appcuesAccountId||this.identity)}get _userProperties(){const t=this.#l?.userProperties,i="object"==typeof this.userProperties?this.userProperties:void 0,e={languages:navigator.languages.map((t=>`[${t.toLowerCase()}]`)).join(";"),...t,...i};return this.#u&&(e.email=this.#u.email||e.email,e.givenName=this.#u.given_name||e.givenName,e.familyName=this.#u.family_name||e.familyName),e}#l;#u;#r;#f;connectedCallback(){super.connectedCallback(),s()}disconnectedCallback(){super.disconnectedCallback(),this.#h&&clearInterval(this.#h),this.#h=void 0}async firstUpdated(t){super.firstUpdated(t),this.#p||await this._apiClientReady,await Promise.allSettled([this.#y(),this.#m(),this.#g()]),this.#r&&(this.defer&&"complete"!==document.readyState?document.addEventListener("readystatechange",(t=>{"complete"===t.target.readyState&&this.#k()})):this.#k(),this.#w&&this.apiUrl&&this._apiClient&&(this.#f=new p(this.apiUrl,this._apiClient)))}render(){return o``}async#g(){const t=await this._loadFeatureFlags();this.#d=t?.flagValues,this.requestUpdate()}#k(){this.#v();const{heapAppId:t,appcuesAccountId:i,identity:e,eventProperties:n}=this.#l??{},s=this.cdnHost??"https://cdn.zywave.com";let o,a;t&&(o=d(t,e,this._userProperties,n,s)),i&&(a=async function(t,i,e,n,s){function o(){window.Appcues.page()}const a=new URL("fast.appcues.com/",s);try{if(await c(a,{preconfigureUrl:i=>(window.AppcuesSettings=Object.assign({},window.AppcuesSettings,{skipAMD:!0}),new URL(`${t}.js`,i))}),window.Appcues){if(import("./_3a3a67e6.js").then((t=>{t.style.styleSheet&&(document.adoptedStyleSheets=[...document.adoptedStyleSheets,t.style.styleSheet])})),i&&!n?.isImpersonating){let t;e&&(t={...e,first_name:e.givenName,last_name:e.familyName},delete t.givenName,delete t.familyName),window.Appcues.identify(i,t)}window.addEventListener("zapiReplaceState",o),window.addEventListener("zapiPushState",o)}return{track(t,i){},trackerId:"Appcues"}}catch{return}}(i,e,this._userProperties,n,s)),l.registerTracker(o),l.registerTracker(a),Promise.allSettled([o,a]).then((()=>{this.dispatchEvent(new CustomEvent("load"))}))}track(t,i){l.track(t,i)}async#y(){if(this.#p)this.#l={heapAppId:this.heapAppId||"",appcuesAccountId:this.appcuesAccountId||"",identity:this.identity||"",contextPath:this.contextPath||""},this.#r=!0;else if(this._authorized&&this._apiClient){const t=new URL("shell/v2.0/analyticsinfo",this.apiUrl);t.searchParams.set("host",window.location.hostname);const i=await this._apiClient.get(t);if(i instanceof Response&&i.ok){const t=await i.json();this.#r=!0,this.#l=t,this.#l.contextPath??=this.contextPath}}else this.#r=!0}async#m(){if(this._authorized&&this._apiClient){const t=new URL("userinfo",this.apiUrl),i=await this._apiClient.fetch(t);if(i instanceof Response&&i.ok){const t=await i.json();this.#u=t}}}async#v(){if(!this.#l?.contextPath)return;const{ActivityTracker:t}=await import("./_a76b817d.js");await t.connect({isImpersonated:this.#l.isImpersonating??!1,cookieDomain:this.#l.cookieDomain}),this.#h=window.setInterval((async()=>{await this.#T(t)}),this.#l?.activityTrackingInterval??2e3),window.addEventListener("visibilitychange",(async()=>{"hidden"===document.visibilityState&&await this.#T(t)}))}async#T(t){const i=await t.retrieveActivity();if(!this.#l?.contextPath||!i.length)return;const e=new URL(`v3/shell/v1.0${this.#l.contextPath}/a/e`,this.apiUrl);this._apiClient?.fetch(e,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"},keepalive:!0})}}u([e({type:String,attribute:"heap-app-id"})],y.prototype,"heapAppId",void 0),u([e({type:String,attribute:"appcues-account-id"})],y.prototype,"appcuesAccountId",void 0),u([e({type:String})],y.prototype,"identity",void 0),u([e({type:Object,attribute:"user-properties"})],y.prototype,"userProperties",void 0),u([e({type:Boolean})],y.prototype,"defer",void 0),u([e({type:String,attribute:"cdn-host"})],y.prototype,"cdnHost",void 0),u([e({type:String,attribute:"context-path"})],y.prototype,"contextPath",void 0),window.customElements.define("zywave-analytics",y);export{l as A};
