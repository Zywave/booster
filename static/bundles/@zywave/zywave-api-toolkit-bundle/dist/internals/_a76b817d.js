const t="zapi:bf";function i(t,i,n,e){const s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3),e=!e||e.startsWith(".")?e:`.${e}`;let r=`${t}=${i}; expires=${s.toUTCString()};path=/;Secure;SameSite=Strict`;e&&window.location.hostname.endsWith(e)&&(r+=`; domain=${e}`),document.cookie=r}function n(t,i,n){const e=Date.now()+24*n*60*60*1e3,s=JSON.stringify({value:i,expires:e});localStorage.setItem(t,s)}function e(t){return window.matchMedia(`(${t})`).matches}const s=class{static get instance(){return this.#t??=new this}static#t;#i;#n;#e=1;constructor(){}async getAttributes(t){return this.#s(t.storageTtlDays,t.cookieDomain),await this.#r(),{t:`v${this.#e}|${this.#i}`,i:this.#n,o:window.screen.width,h:window.screen.height,u:Intl.DateTimeFormat().resolvedOptions().timeZone,p:e("prefers-reduced-motion: reduce"),l:e("prefers-color-scheme: dark")?"dark":"light",g:navigator.globalPrivacyControl??null,v:navigator.doNotTrack??null}}#s(e,s){if(this.#n)return;let r=function(t,n,e){const s=`; ${document.cookie}`.split(`; ${t}=`),r=2===s.length?s.pop()?.split(";").shift():null;return r&&i(t,r,n,e),r}(t,e,s);r||(r=function(t,i){const e=localStorage.getItem(t);if(e){const s=JSON.parse(e);return s.expires<Date.now()?(localStorage.removeItem(t),null):(n(t,s.value,i),s.value)}return null}(t,e),r&&i(t,r,e,s)),r||(r=function(){if(crypto?.randomUUID)return crypto.randomUUID();const t=new Uint32Array(4);return crypto.getRandomValues(t),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){const n=(t[0]+16*Math.random())%16|0;return t[0]=Math.floor(t[0]/16),("x"===i?n:3&n|8).toString(16)}))}(),n(t,r,e),i(t,r,e,s)),this.#n=r}async#r(){if(!this.#i)try{const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)return;const n="ZYWAVE";i.textBaseline="top",i.textBaseline="top",i.font="14px 'Arial'",i.textBaseline="alphabetic",i.fillStyle="#f60",i.fillRect(125,1,62,20),i.fillStyle="#069",i.fillText(n,2,15),i.fillStyle="rgba(102, 204, 0, 0.7)",i.fillText(n,4,17);const e=t.toDataURL().split(",")[1];this.#i=await async function(t){const i=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",i);return[...new Uint8Array(n)].map((t=>t.toString(16).padStart(2,"0"))).join("")}(e)}catch(t){}}}.instance,r=!!window.navigation;const a=class{static get instance(){return this.#t??=new this}static#t;constructor(){this.#a=[],this.#c=!1,this.isImpersonated=!1}#a;#c;#o;#h;async connect(t){this.isImpersonated=t.isImpersonated,this.#o||(this.#o=await s.getAttributes({cookieDomain:t.cookieDomain,storageTtlDays:365})),this.#c||(this.#a.push(this.#u()),this.#w()),this.#c=!0}disconnect(){this.#a=[],this.#c=!1,this.#h&&(r?window.navigation.removeEventListener("currententrychange",this.#h):(window.removeEventListener("zapiPushState",this.#h),window.removeEventListener("zapiReplaceState",this.#h)))}async retrieveActivity(){return new Promise((t=>{const i=[...this.#a];this.#a=[],t(i)}))}#w(){r?(this.#h=this.#x.bind(this),window.navigation.addEventListener("currententrychange",this.#h)):(window.addEventListener("zapiPushState",this.#x.bind(this)),window.addEventListener("zapiReplaceState",this.#x.bind(this)))}#x(){this.#a.push(this.#u())}#u(){return{type:"Navigation",location:window.location.href,eventDateTime:new Date,isImpersonated:this.isImpersonated,bf:this.#o?.i,sw:this.#o?.o,sh:this.#o?.h,cf:this.#o?.t,tz:this.#o?.u,dnt:this.#o?.v,gpc:this.#o?.g,prm:this.#o?.p,pcs:this.#o?.l}}}.instance;export{a as ActivityTracker};
